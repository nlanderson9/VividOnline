<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/plugin-survey-html-form.js"></script>
    <script src="jspsych/plugin-survey-likert.js"></script>
    <script src="jspsych/plugin-survey-multi-choice.js"></script>
    <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
    <script src="jquery-3.7.1.min.js"></script>
    <script src="jquery.csv.js"></script>
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <body></body>
  <script>

    // Import stimuli from CSV
    var data = "";

    test = $.ajax({
            type: "GET",
            url: "stimuli_BNI_order.csv",
            dataType: "text",
            async: false,
            success: function(r) {
              data = r
            }
          });

    var csv_data = $.csv.toObjects(data);


    // Set properties for task
    var req = false;
    var imagine_time = 500;

    var withdrawn = false;
    var num_tries = 1;
    var instructions_failed = false;
    var failed_check_count = 0;


    // Initiate jsPsych; set Prolific redirect pages for various ending states
    var jsPsych = initJsPsych({
      on_trial_start: function(trial){
        trial.type.jsPsych.data.dataProperties.timestamp = (new Date).toISOString().replace(/z|t/gi,' ').trim()
      },
      on_finish: function(){
        if (withdrawn == true){
          window.location = `https://app.prolific.com/submissions/complete?cc=CGE75EJ0`
        } else if (instructions_failed == true){
          window.location = `https://app.prolific.com/submissions/complete?cc=C1AKJYEN`
        } else if(failed_check_count > 1) {
          window.location = `https://app.prolific.com/submissions/complete?cc=CVFKQNDO`
        } else {
          window.location = `https://redcap.nubic.northwestern.edu/redcap/surveys/?s=ET83PMYTR3FRPXCE&prolific_id=${subject_id}&prolific_study_id=${prolific_study_id}&prolific_session_id=${prolific_session_id}&failed_attention_checks=${failed_check_count}`
        }
        
      }
    });


    // Get URL variables
    var subject_id = jsPsych.data.getURLVariable('PROLIFIC_PID')
    var prolific_study_id = jsPsych.data.getURLVariable('PROLIFIC_STUDY_ID')
    var prolific_session_id = jsPsych.data.getURLVariable('PROLIFIC_SESSION_ID')
    const filename = `${subject_id}.csv`;

    // Initialize jsPsych timeline
    timeline = [];

    jsPsych.data.addProperties({
      subject: subject_id
    });

    // Consent page
    var consent = {
      type: jsPsychSurveyMultiChoice,
      preamble: `<div class="rich-text-field-label" style="background-color:white;"><p style="text-align:center;"><span style="font-weight: normal; color: #808080">Information Sheet for Participation in a Human Research Study</span></p><p style="text-align:left;""><span style="font-weight: normal;"><br /><br /><strong data-stringify-type="bold">Title of Research Study: </strong>Role of Imagery in Behavior Study (RIBS)<br /><br /><strong data-stringify-type="bold">Principle Investigator: </strong>Rodrigo M. Braga, PhD<br /><br /><strong data-stringify-type="bold">Supported By: </strong>Northwestern University, Braga Lab<br /><br /></span></p><table style="border-collapse: collapse; width: 90%; margin-left:auto; margin-right:auto;" border="4"> <tbody> <tr> <td style="width: 85%;"> <p style="text-align:center;"><strong data-stringify-type="bold">Key Information:<br /><br />The purpose of this study is to explore how people make choices during tasks.<br />You will be asked to take a series of computer tasks and/or complete questionnaires.<br />We expect you will be in this research study for up to 6 hours.<br />The primary potential risk of participation is fatigue.<br />There are no direct benefits to you from this research.</strong></p> </td> </tr> </tbody> </table><br /><p style="text-align:left;""><span style="font-weight: normal;"><strong data-stringify-type="bold">What is the purpose of this research study?</strong><br /><br />The purpose of this study is to explore how mental imagery influences the behavior of individuals. We will collect responses to computer-based and pencil-and-paper questionnaires to investigate what psychological and physical factors are related to the generation of mental imagery and imagined sensations.<br /><br /><br /><strong data-stringify-type="bold">Why am I being asked to take part in this research study?</strong><br /><br />We are asking you to take part in this research study because you are over the age of 18 years and have expressed interest in taking part in the study.<br /><br /><br /><strong data-stringify-type="bold">How many people will be in this study?</strong><br /><br />We expect about 2,000 people will be in this research study.<br /><br /><br /><strong data-stringify-type="bold">What should I know about participating in a research study?</strong><br /><ul><span style="font-weight: normal; text-align: left;"><li>Someone will explain this research study to you.</li><li>Whether or not you take part is up to you.</li><li>You can choose not to take part.</li><li>You can agree to take part and change your mind later.</li><li>Your decision will not be held against you.</li><li>You can ask all the questions you want before you decide.</li><li>You do not have to answer any question you do not want to answer.</li></span></ul><br /><p style="text-align:left;"><strong data-stringify-type="bold">What happens if I say "Yes, I want to be in this research"?</strong><br /><br /><span style="font-weight: normal; text-decoration:underline;">Consent Documentation Process</span><br /><span style="font-weight: normal;">Please read this information sheet and then acknowledge you have read the information and agree to participate in the study by clicking 'Continue'.<br /><br />Your participation will include completing a series of tasks and questionnaires. You will be asked to turn off and put away your cellphone and any other devices to reduce distractions. You will view questions or be asked to make choices about information presented on a computer screen. This information may include words, pictures, and/or sounds. Questions may include those about your background and demographics, as well as your thoughts, feelings and behaviors. In any task, you will register a choice by pressing buttons or typing a response, and we will record both your choice and how long it took you to press the keys. The tasks will take a maximum of 6 hours to complete.<br /><br />After the study, a member of the research team may contact you to ask if you would like to participate in other studies, including brain imaging (MRI) and other behavioral studies. You can opt out of being recontacted for future studies below, and you are under no obligation to take part in any studies, including this one.<br /><br /><br /><strong data-stringify-type="bold">Will being in this study help me any way?</strong><br /><br />We cannot promise any direct benefits from your participation in this study. Individual results will not be provided. However, if you wish, you can send an email to bragalab@northwestern.edu, and we will send you a copy of any manuscripts that are produced as a result of this research.<br /><br /><br /><strong data-stringify-type="bold">Is there any way being in this study could be bad for me?</strong><br /><br />You may be asked to fill out demographic forms and answer questions which could ask about your personality and day-to-day behaviors. For example, you may be asked about your social interactions with friends and family members, or your personal habits. A small number of the questionnaires may ask about whether you are presently taking or have ever taken medication for depression, anxiety, and other psychiatric or neurological conditions (e.g., schizophrenia), and may ask questions concerning mental health and/or drug craving and use. Hence some of the questions may be of a personal nature. We ask these questions because we want to study the link between thought patterns and the risk of mental health problems or risk-taking. These questions are not intended to be distressing, but some people may feel distressed when answering them.<br /><br />All your answers will be kept strictly confidential and will be de-identified and aggregated with other participant's responses before we conduct our analyses. Your identifiable information will not be shared with anyone outside the study team. We therefore encourage you to be as honest as you can with your responses. If you feel that you would prefer not to answer a question, or that you are not willing to provide an honest response to a question, we prefer that you do not provide any response to that question. You do not have to provide a reason why you did not respond to that question and we will not ask you for a reason.<br /><br />In addition, it is possible that this study's procedures could cause boredom or frustration. You may end your participation in this study anytime you choose, with no penalty or loss of benefits to which you are otherwise entitled.<br /><br /><br /><strong data-stringify-type="bold">What happens if I do not want to be in this research, or I change my mind later?</strong><br /><br />Participation in research is completely voluntary. You decide whether or not to participate. If you choose to not participate, there will be no penalty to you or loss of benefit to which you are entitled.<br /><br />You can leave the research at any time; it will not be held against you.<br /><br />You will receive payment for the time you spend on the tasks, even if you withdraw early. You may withdraw by informing the experimenter (e.g., within the lab or via email at bragalab@northwestern.edu) that you no longer wish to participate. <strong data-stringify-type="bold">You do not need to tell us  why you have chosen to withdraw, and you will not be asked to provide a reason.</strong> Regarding the questionnaires, some items may be required for participation but you may skip others while still continuing to participate in the rest of the study.<br /><br /><br /><strong data-stringify-type="bold">How will researchers protect my information?</strong><br /><br />The results of your examinations will be collected in a computer at the Braga Lab in the Department of Neurology, Northwestern University Feinberg School of Medicine, Chicago, Illinois. Your results will be stored by a code that is not associated with any information that could be used to identify you personally. Data storage and all computers are encrypted. Your name or any other personally identifying information is not stored in this archive and will not be shared with any other investigators. We will not share your test results with you, as this information has been collected for research purposes and is not of any practical and/or diagnostic value to you. Your personal information for the issuance of a check will be kept in a locked file cabinet for a 7-year period per Northwestern University retention guidelines, after which time they will be destroyed.<br /><br /><br /><strong data-stringify-type="bold">Who will have access to the information collected during this research study?</strong><br /><br />The only people who will have access to the identifiable information collected during the research study are the Principal Investigator, Dr. Rodrigo Braga, and the study team. All study team members have been trained by the PI. Your identifiable information will not leave the study premises.<br /><br /><br /><strong data-stringify-type="bold">How might the information collected in this study be shared in the future? </strong><br /><br />Your coded (i.e., non-identifiable) cognitive and demographic information may be shared with other investigators within Northwestern and across the Northwestern research community who are not study team members. We may also make your coded data available to researchers at other academic institutions, which are not a part of the university. The coded information will not contain your name or other information that could likely identify you, and investigators will not be given any information that could link the coded information with identifying information. Under no circumstances will identifiable information be shared. We do not think there will be further risks to your privacy and confidentiality by sharing your deidentified data in this format; however, we cannot predict how information will be used in the future. The information is sent with only a code number attached, and your name or other identifiable information is never provided. There are safeguards in place to protect your information while it is stored in repositories and used for research.<br /><br /><br /><strong data-stringify-type="bold">Will I be paid or given anything for taking part in this study? </strong><br /><br />You will be paid the amount listed for the task you are participating in. Once you have completed the tasks or questionnaires, you will be redirected to Prolific's website to record task completion and ensure payment. <br /><br /><br /><strong data-stringify-type="bold">Whom can I talk to?</strong><br /><br />If you have questions, concerns, or complaints, or think the research has hurt you, talk to the research team at (312) 503-5293 or bragalab@northwestern.edu.<br /><br />This research has been reviewed and approved by an Institutional Review Board (IRB). You may talk to them at (312) 503-9338 or irb@northwestern.edu if:</p><br /><ul><span style="font-weight: normal; text-align: left;"><li>Your questions, concerns, or complaints are not being answered by the research team.</li><li>You cannot reach the research team.</li><li>You want to talk to someone besides the research team.</li><li>You have questions about your rights as a research participant.</li><li>You want to get information or provide input about this research.</li></span></ul><p style="text-align:left;"><span style="font-weight: normal;"><br /><strong data-stringify-type="bold">Can I be removed from the research without my OK?</strong><br /><br />The person in charge of the research study or the sponsor can remove you from the research study without your approval. Possible reasons for removal include incomplete questionnaires or failure to attend testing sessions.<br /><br /><br /><strong data-stringify-type="bold">Confidentiality:</strong><br /><br />Your participation in this study will remain confidential, and your identity will not be stored with your data. Your responses will be assigned a code number, and the list connecting your name with this number will be kept in a secure location. When data are shared, your name will never be shared. All digitally-collected data are encrypted for added security.<br /><br /><br />If you are participating through a web-based platform, there is a chance that your responses could be identified by your associated email address, and your worker ID may be recorded. To maximize your privacy, you may wish to share or create an email address that does not include any identifiable information (such as your name or birthdate). Your coded (i.e., de-identified) data may be shared with other researchers and used in future projects, as described next, but your email address will not be shared.<br /><br /></span></p></p></div>`,
      questions: [
        {prompt: `<div class="rich-text-field-label" style="background-color:white;"><p><span style="font-weight: normal;"><strong data-stringify-type="bold">Optional Elements:</strong><br /><br />The following research activities are optional, meaning that you do not have to agree to them in order to participate in the research study. Please indicate your willingness to participate in these optional activities by checking the box to either 'Opt-In' or 'Opt-Out' to being contacted by the study team about future studies.<br /><br /></span></p></div>`,
         name: "future_studies",
         options: ["Opt-In", "Opt-Out"]},
        {prompt: `<div class="rich-text-field-label" style="background-color:white;"><p><span style="font-weight: normal;"><strong data-stringify-type="bold">Agreement:</strong><br /><br />By clicking 'Continue' below, I acknowledge that the nature and purpose of this research have been sufficiently explained and I agree to participate in this study. I understand that I am free to withdraw at any time without incurring any penalty.<br /><br /></span></p></div>`,
         name: "consent_agree",
         options: ["Continue", "Withdraw"]}
      ],
      on_finish: function(data){
        if(data.response.consent_agree == "Withdraw"){
          withdrawn = true;
          jsPsych.endExperiment();
        }
      }
    }
    timeline.push(consent);

    // Demographics page
    var demographics = {
      type: jsPsychSurveyHtmlForm,
      preamble: '<p>This is the placeholder for the demographics questionnaire</p>',
      html: `
            <!-- Age -->
            <fieldset style="text-align: left;">
              <legend><strong>Age</strong></legend>
              <div>
                <input name="age" type="number" min="1" max="110" />
              </div>
            </fieldset>
            <br>

            <!-- Gender -->
            <fieldset style="text-align: left;">
              <legend><strong>Gender</strong></legend>
              <div>
                <input name="gender" type="radio" id="male" value="male" />
                <label for="male">Male</label>
              </div>
              <div>
                <input name="gender" type="radio" id="female" value="female" />
                <label for="male">Female</label>
              </div>
              <div>
                <input name="gender" type="radio" id="transgender_non_binary" value="transgender_non_binary" />
                <label for="transgender_non_binary">Transgender/Non-binary</label>
              </div>
              <div>
                <input name="gender" type="radio" id="other" value="other" />
                <label for="other">Other</label>
              </div>
            </fieldset>
            <br>
             
            <!-- Ethnicity -->
            <fieldset style="text-align: left;">
              <legend><strong>Ethnicity</strong></legend>
              <div>
                <input name="ethnicity" type="radio" id="hispanic" value="hispanic" />
                <label for="hispanic">Hispanic</label>
              </div>
              <div>
                <input name="ethnicity" type="radio" id="non_hispanic" value="non_hispanic" />
                <label for="non_hispanic">Not Hispanic</label>
              </div>
            </fieldset>
            <br>
            
            <!-- Race -->
            <fieldset style="text-align: left;">
              <legend><strong>Race</strong></legend>
              <div>
                <input name="race" type="radio" id="american_indian_alaska_native_indigenous" value="american_indian_alaska_native_indigenous" />
                <label for="american_indian_alaska_native_indigenous">American Indian/Alaska Native/Indigenous</label>
              </div>
              <div>
                <input name="race" type="radio" id="asian" value="asian" />
                <label for="asian">Asian</label>
              </div>
              <div>
                <input name="race" type="radio" id="black" value="black" />
                <label for="black">Black/African American</label>
              </div>
              <div>
                <input name="race" type="radio" id="white" value="white" />
                <label for="white">Caucasian/White</label>
              </div>
              <div>
                <input name="race" type="radio" id="hawaiian_pacific_islander" value="hawaiian_pacific_islander" />
                <label for="hawaiian_pacific_islander">Native Hawaiian/Pacific Islander</label>
              </div>
              <div>
                <input name="race" type="radio" id="unknown" value="unknown" />
                <label for="unknown">Unknown or Not Reported</label>
              </div>
            </fieldset>
            <br>
            
            <!-- Education -->
            <fieldset style="text-align: left;">
              <legend><strong>Highest level of education</strong></legend>
              <div>
                <input name="education" type="radio" id="junior_high" value="junior_high" />
                <label for="junior_high">Junior High</label>
              </div>
              <div>
                <input name="education" type="radio" id="some_high_school" value="some_high_school" />
                <label for="some_high_school">Some High School</label>
              </div>
              <div>
                <input name="education" type="radio" id="high_school_diploma" value="high_school_diploma" />
                <label for="high_school_diploma">High school diploma or equivalent degree</label>
              </div>
              <div>
                <input name="education" type="radio" id="associates_degree" value="associates_degree" />
                <label for="associates_degree">Associate's degree</label>
              </div>
              <div>
                <input name="education" type="radio" id="bachelors_degree" value="bachelors_degree" />
                <label for="bachelors_degree">Bachelor's degree</label>
              </div>
              <div>
                <input name="education" type="radio" id="masters_degree" value="masters_degree" />
                <label for="masters_degree">Master's degree</label>
              </div>
              <div>
                <input name="education" type="radio" id="doctorate" value="doctorate" />
                <label for="doctorate">Doctorate (PhD, MD, JD, etc.)</label>
              </div>
            </fieldset>
            <br>
            
            <!-- Native English -->
            <fieldset style="text-align: left;">
              <legend><strong>First Language</strong></legend>
                Was English your first language?
              <div>
                <input name="native_english" type="radio" id="english_yes" value="english_yes" />
                <label for="english_yes">Yes</label>
              </div>
              <div>
                <input name="native_english" type="radio" id="english_no" value="english_no" />
                <label for="english_no">No</label>
              </div>
            </fieldset>
            <br>
            
            <!-- Age Starting English -->
            <fieldset style="text-align: left;">
              <legend><strong>Age Learning English</strong></legend>
              If English was <strong><u>not</u></strong> your first language,<br>at what age did you first learn English?
              <div>
                <input name="learning_english" type="number" min="0", max="110" />
              </div>
            </fieldset>
            <br>
            
            <!-- Vision -->
            <fieldset style="text-align: left;">
              <legend><strong>Vision</strong></legend>
              Do you have normal, or corrected-to-normal, vision?
              <div>
                <input name="vision" type="radio" id="vision_yes" value="vision_yes" />
                <label for="vision_yes">Yes</label>
              </div>
              <div>
                <input name="vision" type="radio" id="vision_no" value="vision_no" />
                <label for="vision_no">No</label>
              </div>
            </fieldset>`
    };
    timeline.push(demographics);

    // Set text and response options for Instructions page questions
    var task_instruction_text = `<p style="text-align: left;"><span style="font-weight: normal; text-align: left;">In this task, we're going to ask you to imagine or remember different things.<br><br>First, a short sentence will appear on the screen for you to read, for example: "Imagine a castle on a hill" or "Remember the face of your boss."<br><br><strong data-stringify-type="bold">You will then be given 5 seconds to do whatever the sentence you just read instructed you to do, before moving on.</strong> Please keep your eyes open while you are thinking about the sentence.<br><br>If the instruction doesn't make sense for you (for example, if you don't have a boss), just think of something similar (e.g. the face of a colleague, or a friend). You also don't have to try really hard to be completely accurate in your memory of that person or thing, we just want you to think about (imagine or remember) that person or thing, however you might normally do that. Similarly, if you are not sure what the instruction is asking you to imagine, that's ok; just answer the questions as best as you can.<br><br>Sometimes when people perform this kind of imagining, people experience mental sensations, similar to dreams. For example, if you are asked to "Imagine a red sports car", you might experience a mental visual image of a red sports car, almost as if you were "seeing" it in your mind. Similarly, if you were asked to "Imagine singing When the Saints Go Marching In", while you do this you might feel as if you are experiencing sounds, almost as if you were "hearing" the song play inside your mind. These mental sensations are perfectly normal and are the topic of this study.<br><br><strong data-stringify-type="bold">Once you have finished imagining, we will ask you a series of questions about what you thought about.</strong><br><br>The first two questions will be about the "vividness" of your thinking, for both visual images and auditory sounds. For example:<br><strong data-stringify-type="bold">"While imagining this, how vividly did you experience mental images/sounds?"</strong><br></span></p> <p><span style="font-weight: normal; text-align: left;"><ul style="text-align: left;"><li><strong data-stringify-type="bold">"Nothing"</strong> means you did not experience any mental images or sounds at all.</li><li><strong data-stringify-type="bold">"Vague"</strong> means you think you did experience mental images or sounds, but they were dim or dull or not very clear.</li><li><strong data-stringify-type="bold">"Moderate"</strong> means you did experience mental images or sounds, and you feel that they were relatively clear or vivid.</li><li><strong data-stringify-type="bold">"Vivid"</strong> means you did experience mental images or sounds, and they were very clear and vivid, almost similar to if you were actually hearing or seeing the item in real life.</li></ul></p><p style="text-align: left;"></span><br><span style="font-weight: normal; text-align: left;">The remaining questions will ask you to agree or disagree with statements, based on how much you believe they apply to your imagining of that sentence (for example, after imagining a motorcycle, you might agree or disagree that you "envisioned the location of objects, people, or places").<br><br>It's important to remember that there is no correct or incorrect answer to any of the questions. We just want you to tell us as honestly as you can what you experienced during the thinking period.<br><br><strong data-stringify-type="bold">There will be approximately 25 sentences to imagine or remember, and then answer questions about.</strong><br><br>Please answer the questions below, and then you can begin the task.<br><br><br></span><span style="font-size: 150; color: #0000C8;"><em>Please re-read the instructions above if you are not sure of an answer. You will have two opportunities to get these questions correct.</em></span></p>`
    var task_instructions_fail_text = `<p><span style="font-weight: normal; text-align: left;"><span style="font-size: 150; color: #C80000;"><strong data-stringify-type="bold">Sorry, not all of your answers were correct.<br>Please carefully re-read the instructions below and try the questions again to continue.<br>You will only have one more attempt to successfully answer these questions.</strong></span></span></p>`
    
    var instructions_question1_text = `<strong>When thinking about the sentence, your eyes should be:</strong>`
    var instructions_question2_text = `<strong>Before answering the questions, you will spend _____ seconds thinking about what the sentence instructs</strong>`
    var instructions_question3_text = `<strong>When rating the vividness of mental images and sounds, the rating of "Moderate" means:</strong>`


    var instructions_question1_options = ["Open", "Closed", "Open or close, it doesn't matter"]
    var instructions_question1_correct = 0 // First option (index starts at 0)
    var instructions_question2_options = ["2", "5", "15", "30"]
    var instructions_question2_correct = 1 // Second option (index starts at 0)
    var instructions_question3_options = ["you did not experience any mental images or sounds at all", "you think you did experience mental images or sounds, but they were dim or dull or not very clear", "you did experience mental images or sounds, and you feel that they were relatively clear or vivid", "you did experience mental images or sounds, and they were very clear and vivid, almost similar to if you were actually hearing or seeing the item in real life"]
    var instructions_question3_correct = 2 // third option (index starts at 0)

    // Instructions page
    var instructions = {
      type: jsPsychSurveyMultiChoice,
      preamble: task_instruction_text,
      questions: [
        {prompt: instructions_question1_text,
         name: "instructions_quiz1",
         options: instructions_question1_options},
        {prompt: instructions_question2_text,
         name: "instructions_quiz2",
         options: instructions_question2_options},
         {prompt: instructions_question3_text,
         name: "instructions_quiz3",
         options: instructions_question3_options}
      ],
      data: {
        instructions_num_tries: num_tries
      }
    }
    timeline.push(instructions);

    // Second Instructions page attempt
    var instructions_reattempt = {
      type: jsPsychSurveyMultiChoice,
      preamble: task_instructions_fail_text + task_instruction_text,
      questions: [
        {prompt: instructions_question1_text,
         name: "instructions_quiz1",
         options: instructions_question1_options},
        {prompt: instructions_question2_text,
         name: "instructions_quiz2",
         options: instructions_question2_options},
         {prompt: instructions_question3_text,
         name: "instructions_quiz3",
         options: instructions_question3_options}
      ],
      on_finish: function(data) {
        num_tries += 1
        data.instructions_num_tries = num_tries;
      }
    }

    // Conditional to show second Instructions page attempt
    var instructions_reattempt_conditional = {
      timeline: [instructions_reattempt],
      conditional_function: function() {
          var data = jsPsych.data.get().last(1).values()[0];
          if(data.response.instructions_quiz1 == instructions_question1_options[instructions_question1_correct] & data.response.instructions_quiz2 == instructions_question2_options[instructions_question2_correct] & data.response.instructions_quiz3 == instructions_question3_options[instructions_question3_correct]){
                return false;
            } else {
                return true;
            }
        }
    }
    timeline.push(instructions_reattempt_conditional)

    // End state - failed instructions questions
    var instructions_failed = {
        type: jsPsychSurveyHtmlForm,
        preamble: `<p>Unfortunately, you answered one or more questions incorrectly after two attempts.<br><br>
          Please click below to return to Prolific and return your study submission..<br><br></p>`,
        html: "",
        button_label: "Return to Prolific",
        on_finish: function(data) {
          instructions_failed = true;
          jsPsych.endExperiment();
        }
      }

    // Conditional to show failed instructions questions
    var instructions_failed_conditional = {
      timeline: [instructions_failed],
      conditional_function: function() {
          var data = jsPsych.data.get().last(1).values()[0];
          if(data.response.instructions_quiz1 == instructions_question1_options[instructions_question1_correct] & data.response.instructions_quiz2 == instructions_question2_options[instructions_question2_correct] & data.response.instructions_quiz3 == instructions_question3_options[instructions_question3_correct]){
                return false;
            } else {
                return true;
            }
        }
    }
    timeline.push(instructions_failed_conditional)

    // Instructions correct, begin experiment page
    var start_experiment = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<p></span><span style="color: #009900;">Correct!</span><br>You are now ready to begin the experiment.<br><br>Press the <strong>X</strong> key to begin.</p>`,
      choices: ["x"]
    };
    timeline.push(start_experiment);

    // Imagine/remember stimuli presentation pages
    var imagine = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        return `<div style="font-size:60px;">${jsPsych.timelineVariable('stimulus')}</div>`
      },
      choices: "NO_KEYS",
      trial_duration: imagine_time,
      data: {
        task: 'imagine',
        prompt: jsPsych.timelineVariable('stimulus'),
        category: jsPsych.timelineVariable('category'),
        condition: jsPsych.timelineVariable('condition'),
        trial_number: jsPsych.timelineVariable('trial_number')
      }
    };

    // Define questions/responses for thought probes
    var vividness_labels = ['Nothing', 'Vague', 'Moderate', 'Vivid'];
    var probe_labels = ['Strongly Disagree', '', 'Disagree', '', 'Neutral', '', 'Agree', '', 'Strongly Agree'];

    var probe_questions = [
      {prompt: "How vividly did you imagine mental images?", name: "visual_vividness", labels: vividness_labels, required: req},
      {prompt: "How vividly did you imagine mental sounds?", name: "auditory_vividness", labels: vividness_labels, required: req},
      {prompt: "I envisioned the location of objects, people, or places", name: "locations", labels: probe_labels, required: req},
      {prompt: "I felt immersed in my thoughts, as if I was experiencing the item(s) in real life", name: "immersion", labels: probe_labels, required: req},
      {prompt: "I imagined a sequence of events unfolding in my mind", name: "sequence", labels: probe_labels, required: req},
      {prompt: "My thoughts included elaboration and detail beyond what the prompt included", name: "elaboration", labels: probe_labels, required: req},
      {prompt: "My thoughts involved speech or written language", name: "speech_lang", labels: probe_labels, required: req},
      {prompt: "My thoughts included my internal voice or 'inner speech'", name: "internal_voice", labels: probe_labels, required: req},
      {prompt: "My thoughts included specific, identifiable words or phrases", name: "specific_words", labels: probe_labels, required: req},
      {prompt: "I thought about other people", name: "other_people", labels: probe_labels, required: req},
      {prompt: "I thought about an event from my past or in the future", name: "past_future", labels: probe_labels, required: req},
      {prompt: "I thought about feelings, preferences, or emotions", name: "feelings", labels: probe_labels, required: req},
      {prompt: "I thought about abstract concepts, such as truth, beauty, or fairness", name: "abstract", labels: probe_labels, required: req},
      {prompt: "My mind wandered and I was not focused when imagining this", name: "mind_wandering", labels: probe_labels, required: req},
      {prompt: "I found it difficult to imagine this item", name: "difficult", labels: probe_labels, required: req},
      {prompt: "I was able to imagine what was asked successfully", name: "success", labels: probe_labels, required: req},
      {prompt: "To imagine this, I drew on a memory of a specific fact, place, person, or object", name: "specific_memory", labels: probe_labels, required: req}
    ];

    // Define questions/responses for attention checks
    var attention_questions1 = {prompt: "As an attention check, please select 'Strongly Disagree'", name: "attention_check1", labels: probe_labels, required: req};
    var attention_questions2 = {prompt: "As an attention check, please select 'Neutral'", name: "attention_check2", labels: probe_labels, required: req};
    var attention_questions3 = {prompt: "As an attention check, please select 'Agree'", name: "attention_check3", labels: probe_labels, required: req};

    var attention_correct1 = 0;
    var attention_correct2 = 4;
    var attention_correct3 = 6;

    // Thought probe questions page
    var question = {
      type: jsPsychSurveyLikert,
      preamble: function() {
        return `<br><br><div style="font-size:60px;">${jsPsych.timelineVariable('stimulus')}</div>`
      },
      questions: function () {
        attention_check_status = jsPsych.timelineVariable('attention_check')
        var use_probes = probe_questions.slice();
        if (attention_check_status == 1) {
          use_probes.splice(6,0,attention_questions1)
        }
        if (attention_check_status == 2) {
          use_probes.splice(11,0,attention_questions2)
        }
        if (attention_check_status == 3) {
          use_probes.splice(15,0,attention_questions3)
        }
        return use_probes
      },
      scale_width: 500,
      data: {
        task: 'questions',
        prompt: jsPsych.timelineVariable('stimulus'),
        category: jsPsych.timelineVariable('category'),
        condition: jsPsych.timelineVariable('condition'),
        trial_number: jsPsych.timelineVariable('trial_number'),
        attention_check: jsPsych.timelineVariable('attention_check')
      },
      on_finish: function(data) {
        if (data.attention_check == 1 & data.response.attention_check1 != attention_correct1) {
          failed_check_count += 1
        } else if (data.attention_check == 2 & data.response.attention_check2 != attention_correct2) {
          failed_check_count += 1
        } else if (data.attention_check == 3 & data.response.attention_check3 != attention_correct3) {
          failed_check_count += 1
        }
      }
    };

    // Asynchronous function to launch experiment
    async function createExperiment(){

      // Query jsPsych DataPipe to get condition assignment for this subject
      const condition = await jsPsychPipe.getCondition("zM4MjmVtRXlb");

      jsPsych.data.addProperties({
        condition: condition
      });

      // Based on condition, subsets stimuli CSV to get correct stimuli
      var use_stimuli = csv_data.filter(function(row) {
        return row["group"] == condition;
      });

      use_stimuli.forEach(function(row, index) {
        row.trial_number = index; // Add row number starting from 0
      });

      // Create imagine/thought probe trials based on stimuli
      var test_procedure = {
        timeline: [imagine, question],
        timeline_variables: use_stimuli
      };
      timeline.push(test_procedure);

      // End state  - either succeeded, or failed multiple attention checks
      var redirect = {
        type: jsPsychSurveyHtmlForm,
        preamble: function() {
          if(failed_check_count > 1) {
            return `<p><span style="color: #C80000;">Unfortunately, you failed two (2) or more attention checks during the experiment.<br><br>
          Please click below to return to Prolific.</span><br><br></p>`
          } else {
            return `<p>Thank you! You've completed this part of the experiment.<br><br>
          Please click below to be redirected to the page with the next section of the experiment.<br><br></p>`
          }
        },
        html: "",
        button_label: function() {
          if(failed_check_count > 1) {
            return `Return to Prolific`
          } else {
            return `Proceed to next section`
          }
        },
        on_finish: function(data) {
          if(failed_check_count > 1) {
            data.task_finished = "FAILED_ATTENTION_CHECKS"
          } else {
            data.task_finished = "TRUE"
          }
        }
      }
      timeline.push(redirect)

      // Save subject data via DataPipe
      const save_data = {
        type: jsPsychPipe,
        action: "save",
        experiment_id: "zM4MjmVtRXlb",
        filename: filename,
        data_string: ()=>jsPsych.data.get().csv()
      };

      timeline.push(save_data)

      jsPsych.run(timeline);
    }
    
    // Launch experiment
    createExperiment();
  </script>
</html>